!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CP=t.CP||{})}(this,(function(t){"use strict";t.Cesium3DTilesLoader=class{constructor(t,e){this.Cesium=t,this.viewer=e,this.tileset=null}load(t,e,i={}){const s=this.Cesium,o=this.viewer;return e=Object.assign({lon:116.391311,lat:39.90616,hgt:0,rx:0,ry:0,rz:0,scale:1},e),i=Object.assign(i,{url:t}),this.tileset=o.scene.primitives.add(new s.Cesium3DTileset(i)),this.tileset.readyPromise.then((()=>{const t=s.Cartesian3.fromDegrees(e.lon,e.lat,e.hgt),i=s.Transforms.eastNorthUpToFixedFrame(t),o=s.Matrix4.fromUniformScale(e.scale),n=s.Matrix3.fromRotationX(s.Math.toRadians(e.rx)),a=s.Matrix3.fromRotationY(s.Math.toRadians(e.ry)),r=s.Matrix3.fromRotationZ(s.Math.toRadians(e.rz)),l=s.Matrix4.fromRotationTranslation(n),h=s.Matrix4.fromRotationTranslation(a),c=s.Matrix4.fromRotationTranslation(r);s.Matrix4.multiply(i,o,i),s.Matrix4.multiply(i,l,i),s.Matrix4.multiply(i,h,i),s.Matrix4.multiply(i,c,i),this.tileset._root.transform=i})),this.tileset}locate(){this.viewer.zoomTo(this.tileset)}destroy(){this.tileset=this.tileset&&this.tileset.destroy()}},t.FloodAnalysis=class{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.pos=i,this.waterPolygon=null,this.defaultFloodOpts=null,this.floodOpts=s,this.initOpts()}initOpts(){this.defaultFloodOpts=Object.assign({waterHeight:0,targetWaterHeight:100,speed:1,waterColor:new Cesium.Color.fromBytes(64,157,250,120)},this.floodOpts)}startCallbackProperty(t){return new this.Cesium.CallbackProperty((()=>(this.defaultFloodOpts.waterHeight+=this.defaultFloodOpts.speed,this.defaultFloodOpts.waterHeight>this.defaultFloodOpts.targetWaterHeight?this.defaultFloodOpts.waterHeight=this.defaultFloodOpts.targetWaterHeight:t(this.defaultFloodOpts.waterHeight),this.defaultFloodOpts.waterHeight)),!1)}getCurrentWaterHeight(){return this.defaultFloodOpts.waterHeight}setCurrentWaterHeight(t){this.waterPolygon.polygon.extrudedHeight=new Cesium.CallbackProperty((()=>t),!1)}start(t){const e=this.Cesium,i=this.viewer;this.waterPolygon?this.waterPolygon.polygon.extrudedHeight=this.startCallbackProperty(t):this.waterPolygon=i.entities.add({polygon:{hierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArray(this.pos)),perPositionHeight:!0,extrudedHeight:this.startCallbackProperty(t),material:this.defaultFloodOpts.waterColor}})}pause(){const t=this.Cesium;this.waterPolygon.polygon.extrudedHeight=new t.CallbackProperty((()=>this.defaultFloodOpts.waterHeight),!1)}destroy(){this.viewer.entities.remove(this.waterPolygon),this.waterPolygon=null,this.initOpts()}},t.HTMLOverlay=class{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.isShow=!0,this.container=document.getElementById(i),this.loadOpts=Object.assign({offset:{x:0,y:0},hideOnBack:!0},s),this.load()}load(){const t=this.Cesium,e=this.viewer,i=new t.Cartesian2;e.scene.preRender.addEventListener((()=>{if(!0===this.isShow){const s=e.scene.cartesianToCanvasCoordinates(this.loadOpts.position,i);let o=!0;if(!0===this.loadOpts.hideOnBack){o=new t.EllipsoidalOccluder(t.Ellipsoid.WGS84,e.camera.position).isPointVisible(this.loadOpts.position)}t.defined(s)&&o?(this.container.style.display="block",this.container.style.top=s.y-this.loadOpts.offset.y+"px",this.container.style.left=s.x-this.loadOpts.offset.x+"px"):this.container.style.display="none"}}))}show(){this.isShow=!0,this.container.style.display="block"}hide(){this.isShow=!1,this.container.style.display="none"}destroy(){this.container&&this.container.parentElement.removeChild(this.container),viewer.scene.postRender.removeEventListener()}},t.PositionPicker=class{constructor(t,e){this.Cesium=t,this.viewer=e,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.canvas)}pick(t,e=!0){const i=this.Cesium,s=this.viewer;this.handler.setInputAction((o=>{const n=s.scene.globe.pick(s.camera.getPickRay(o.position),s.scene);if(n){const o=s.scene.globe.ellipsoid.cartesianToCartographic(n),a=i.Math.toDegrees(o.latitude),r=i.Math.toDegrees(o.longitude),l=o.height;e&&function(t,e="14px",i="#292421",s="#B6D5F1"){let o="";if(Array.isArray(t)){for(let e=0;e<t.length;e++)o+=t[e]+"\n";o=o.slice(0,o.length-1)}else o=t;console.log(`%c${o}`,`font-size: ${e}; background: ${s}; color: ${i}; padding: 4px 8px; border-radius: 5px; margin: 1px 0px;`)}([`lon: ${r}`,`lat: ${a}`,`hgt: ${l}`]),"function"==typeof t&&t({lon:r,lat:a,hgt:l})}}),i.ScreenSpaceEventType.LEFT_CLICK)}destroy(){this.handler=this.handler&&this.handler.destroy()}disable(){const t=this.Cesium;this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)}},t.RotateAroundPoint=class{constructor(t,e,i){this.Cesium=t,this.viewer=e,this.rotateOpts=i}addEvent(){this.viewer.clock.onTick.addEventListener(this.around,this)}removeEvent(){this.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.viewer.clock.onTick.removeEventListener(this.around,this)}start(){this.removeEvent(),this.addEvent()}pause(){this.removeEvent()}around(){const t=this.Cesium,e=this.viewer;let i=e.camera.heading;i+=t.Math.toRadians(this.rotateOpts.degrees),e.camera.lookAt(this.rotateOpts.position,new t.HeadingPitchRange(i,e.camera.pitch,this.rotateOpts.range))}},t.Tooltip=class{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.container=null,this.inner=null,this.isShow=!0,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.canvas),this.init(i,s)}init(t,e){const i=this.Cesium,s=this.viewer,o={offset:{left:30,top:50},containerStyle:{display:"block",position:"absolute",maxWidth:"150px",minWidth:"100px",borderRadius:"4px",background:"#757575",color:"#fafafa",zIndex:"999"},innerStyle:{padding:"5px 8px",fontSize:"10px",fontWeight:"400"},isShowOnlyOnEarth:!0};Object.keys(o).forEach((t=>{"object"==typeof o[t]?Object.assign(o[t],e[t]):o[t]=e[t]})),this.container=document.createElement("div"),this.inner=document.createElement("div"),this.inner.innerHTML=t,Object.assign(this.container.style,o.containerStyle),Object.assign(this.inner.style,o.innerStyle),this.container.appendChild(this.inner),this.viewer.cesiumWidget.container.appendChild(this.container),this.handler.setInputAction((t=>{if(this.isShow){s.camera.pickEllipsoid(t.endPosition,s.scene.globe.ellipsoid)&&o.isShowOnlyOnEarth||!o.isShowOnlyOnEarth?(this.container.style.display="block",this.setPosition(t.endPosition,o.offset)):this.container.style.display="none"}}),i.ScreenSpaceEventType.MOUSE_MOVE)}setPosition(t,e){this.container.style.left=t.x+e.left+"px",this.container.style.top=t.y-this.container.clientHeight/2+e.top+"px"}show(){this.isShow=!0,this.container.style.display="block"}hide(){this.isShow=!1,this.container.style.display="none"}destroy(){this.viewer.cesiumWidget.container.removeChild(this.container),this.handler=this.handler&&this.handler.destroy()}},t.WaterMask=class{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.normalMapUrl=i,this.waterMaskOpts=s,this.waterMaskPrimitive=null}load(){const t=this.Cesium,e=this.viewer,i=Object.assign({baseWaterColor:new t.Color.fromBytes(64,157,250,60),frequency:200,animationSpeed:.002,amplitude:5,specularIntensity:1},this.waterMaskOpts),s=new t.PolygonGeometry({polygonHierarchy:new t.PolygonHierarchy(t.Cartesian3.fromDegreesArray(i.pos)),extrudedHeight:0,height:0,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),o=new t.GroundPrimitive({geometryInstances:new t.GeometryInstance({geometry:s}),appearance:new t.EllipsoidSurfaceAppearance({aboveGround:!0}),show:!0,classificationType:t.ClassificationType.TERRAIN});return o.appearance.material=new t.Material({fabric:{type:"Water",uniforms:{baseWaterColor:i.baseWaterColor,normalMap:this.normalMapUrl,frequency:i.frequency,animationSpeed:i.animationSpeed,amplitude:i.amplitude,specularIntensity:i.specularIntensity}}}),this.waterMaskPrimitive=e.scene.primitives.add(o),this.waterMaskPrimitive}destroy(){this.viewer.scene.primitives.remove(this.waterMaskPrimitive)}},t.exportSceneAsImage=function(t,e,i){t.render();const s=i||"png";let o=t.scene.canvas.toDataURL(`image/${s}`).replace(`image/${s}`,"image/octet-stream"),n=document.createElement("a"),a=function(t){let e=t.split(","),i=e[0].match(/:(.*?);/)[1],s=atob(e[1]),o=s.length,n=new Uint8Array(o);for(;o--;)n[o]=s.charCodeAt(o);return new Blob([n],{type:i})}(o),r=URL.createObjectURL(a);n.download=e?`${e}.${s}`:`Scene-${(new Date).getTime()}.${s}`,n.href=r,n.click()},Object.defineProperty(t,"__esModule",{value:!0})}));
